<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pietro Rota">

<title>Implied Probability Density Functions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="IPDF_files/libs/clipboard/clipboard.min.js"></script>
<script src="IPDF_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="IPDF_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="IPDF_files/libs/quarto-html/popper.min.js"></script>
<script src="IPDF_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="IPDF_files/libs/quarto-html/anchor.min.js"></script>
<link href="IPDF_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="IPDF_files/libs/quarto-html/quarto-syntax-highlighting-a37c72dd2dbac68997fcdc15a3622e78.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="IPDF_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="IPDF_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="IPDF_files/libs/bootstrap/bootstrap-abcefaed3b5d0dd009744ac446e232b3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
  
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Implied Probability Density Functions</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Pietro Rota </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.bayes.citystgeorges.ac.uk/">
            Bayes business school - City St.&nbsp;George
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<div id="330f96a9" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> brentq</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The core concept is based on Breeden and Litzenberger (1978), who showed that the second derivative of a European call price with respect to strike gives the risk-neutral PDF of the underlying asset price at maturity: <span class="math display">\[
f(K)=e^{rT} ⋅ \frac{∂^2C(K)}{∂K^2}​
\]</span></p>
<div id="64334025" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> black_scholes_price(S, K, T, r, sigma, option_type<span class="op">=</span><span class="st">"call"</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Black-Scholes price for call/put"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(S <span class="op">/</span> K) <span class="op">+</span> (r <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> option_type <span class="op">==</span> <span class="st">"call"</span>:</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> S <span class="op">*</span> norm.cdf(d1) <span class="op">-</span> K <span class="op">*</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T) <span class="op">*</span> norm.cdf(d2)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># put</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> K <span class="op">*</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T) <span class="op">*</span> norm.cdf(<span class="op">-</span>d2) <span class="op">-</span> S <span class="op">*</span> norm.cdf(<span class="op">-</span>d1)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> implied_volatility(market_price, S, K, T, r, option_type<span class="op">=</span><span class="st">"call"</span>):</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Solve for IV using Brent root finder"""</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        f <span class="op">=</span> <span class="kw">lambda</span> sigma: black_scholes_price(S, K, T, r, sigma, option_type) <span class="op">-</span> market_price</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> brentq(f, <span class="fl">1e-6</span>, <span class="fl">5.0</span>, maxiter<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> implied_pdf(S, K, T, r, sigma):</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Breeden-Litzenberger: risk-neutral density via BS second derivative wrt strike"""</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(S <span class="op">/</span> K) <span class="op">+</span> (r <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    pdf <span class="op">=</span> (np.exp(<span class="op">-</span>r<span class="op">*</span>T) <span class="op">*</span> norm.pdf(d2)) <span class="op">/</span> (K <span class="op">*</span> sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="13451efa" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ticker <span class="op">=</span> <span class="st">"SPY"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>stock <span class="op">=</span> yf.Ticker(ticker)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> stock.history(period<span class="op">=</span><span class="st">"1d"</span>)[<span class="st">"Close"</span>].iloc[<span class="op">-</span><span class="dv">1</span>]  <span class="co"># spot price</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>interest <span class="op">=</span> yf.Ticker(<span class="st">"^IRX"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> interest.history(period<span class="op">=</span><span class="st">"1d"</span>)[<span class="st">"Close"</span>].iloc[<span class="op">-</span><span class="dv">1</span>]<span class="op">/</span><span class="dv">100</span>  <span class="co"># assume risk-free rate ~5% (you could pull ^IRX)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="acaf1626" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_probability_distribution(strike, spot, iv, days_to_exp, risk_free_rate <span class="op">=</span> r):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate the implied probability distribution from Black-Scholes</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns price range and probability density</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    T <span class="op">=</span> days_to_exp <span class="op">/</span> <span class="fl">365.0</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> T <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">or</span> iv <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate price range (±4 standard deviations)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    std_dev <span class="op">=</span> spot <span class="op">*</span> iv <span class="op">*</span> np.sqrt(T)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    price_range <span class="op">=</span> np.linspace(<span class="bu">max</span>(spot <span class="op">-</span> <span class="dv">4</span><span class="op">*</span>std_dev, <span class="fl">0.01</span>), spot <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>std_dev, <span class="dv">200</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate log-normal distribution parameters</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> np.log(spot) <span class="op">+</span> (risk_free_rate <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> iv<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> T</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> iv <span class="op">*</span> np.sqrt(T)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Probability density function</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    pdf <span class="op">=</span> (<span class="dv">1</span> <span class="op">/</span> (price_range <span class="op">*</span> sigma <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> np.pi))) <span class="op">*</span> <span class="op">\</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>          np.exp(<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> ((np.log(price_range) <span class="op">-</span> mu) <span class="op">/</span> sigma)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> price_range, pdf</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_option_chain_data(ticker_symbol):</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">    Fetch complete option chain data for all expirations</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    ticker <span class="op">=</span> yf.Ticker(ticker_symbol)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    current_price <span class="op">=</span> ticker.history(period<span class="op">=</span><span class="st">'1d'</span>)[<span class="st">'Close'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    expirations <span class="op">=</span> ticker.options</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    all_options <span class="op">=</span> []</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> exp_date <span class="kw">in</span> expirations:</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        opt_chain <span class="op">=</span> ticker.option_chain(exp_date)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process calls</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        calls <span class="op">=</span> opt_chain.calls.copy()</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        calls[<span class="st">'type'</span>] <span class="op">=</span> <span class="st">'call'</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        calls[<span class="st">'expiration'</span>] <span class="op">=</span> exp_date</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process puts</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        puts <span class="op">=</span> opt_chain.puts.copy()</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        puts[<span class="st">'type'</span>] <span class="op">=</span> <span class="st">'put'</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        puts[<span class="st">'expiration'</span>] <span class="op">=</span> exp_date</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        all_options.append(pd.concat([calls, puts]))</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    options_df <span class="op">=</span> pd.concat(all_options, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate days to expiration</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    options_df[<span class="st">'expiration'</span>] <span class="op">=</span> pd.to_datetime(options_df[<span class="st">'expiration'</span>])</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    options_df[<span class="st">'days_to_exp'</span>] <span class="op">=</span> (options_df[<span class="st">'expiration'</span>] <span class="op">-</span> datetime.now()).dt.days</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out options with missing IV</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    options_df <span class="op">=</span> options_df[options_df[<span class="st">'impliedVolatility'</span>].notna()]</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    options_df <span class="op">=</span> options_df[options_df[<span class="st">'impliedVolatility'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> options_df, current_price</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_3d_ipdf_surface(options_df, current_price):</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="co">    Create 3D surface plot showing how IPDF changes across strikes and expirations</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by expiration</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    expirations <span class="op">=</span> <span class="bu">sorted</span>(options_df[<span class="st">'expiration'</span>].unique())</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data for surface plot</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    price_ranges <span class="op">=</span> []</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    pdfs_matrix <span class="op">=</span> []</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>    exp_labels <span class="op">=</span> []</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> exp <span class="kw">in</span> expirations[:<span class="dv">8</span>]:  <span class="co"># Limit to first 8 expirations for clarity</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        exp_data <span class="op">=</span> options_df[options_df[<span class="st">'expiration'</span>] <span class="op">==</span> exp]</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        days_to_exp <span class="op">=</span> exp_data[<span class="st">'days_to_exp'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use ATM option IV as reference</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>        atm_option <span class="op">=</span> exp_data.iloc[(exp_data[<span class="st">'strike'</span>] <span class="op">-</span> current_price).<span class="bu">abs</span>().argsort()[:<span class="dv">1</span>]]</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(atm_option) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>            iv <span class="op">=</span> atm_option[<span class="st">'impliedVolatility'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>            price_range, pdf <span class="op">=</span> calculate_probability_distribution(</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>                current_price, current_price, iv, days_to_exp</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> price_range <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>                price_ranges.append(price_range)</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>                pdfs_matrix.append(pdf)</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>                exp_labels.append(<span class="ss">f"</span><span class="sc">{</span>exp<span class="sc">.</span>strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>days_to_exp<span class="sc">}</span><span class="ss">d)"</span>)</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create meshgrid for 3D plot</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(price_ranges) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>        fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[go.Surface(</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>price_ranges[<span class="dv">0</span>],</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(exp_labels))),</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>            z<span class="op">=</span>pdfs_matrix,</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>            colorscale<span class="op">=</span><span class="st">'Viridis'</span>,</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>            opacity<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="st">'Probability Density'</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>        )])</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>        fig.update_layout(</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>            title<span class="op">=</span><span class="st">'3D Implied Probability Distribution - Full Option Chain'</span>,</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>            scene<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>                xaxis_title<span class="op">=</span><span class="st">'Stock Price'</span>,</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>                yaxis<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>                    title<span class="op">=</span><span class="st">'Expiration'</span>,</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>                    ticktext<span class="op">=</span>exp_labels,</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>                    tickvals<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(exp_labels)))</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>                zaxis_title<span class="op">=</span><span class="st">'Probability Density'</span>,</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>                camera<span class="op">=</span><span class="bu">dict</span>(eye<span class="op">=</span><span class="bu">dict</span>(x<span class="op">=</span><span class="fl">1.5</span>, y<span class="op">=</span><span class="fl">1.5</span>, z<span class="op">=</span><span class="fl">1.3</span>))</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>            height<span class="op">=</span><span class="dv">700</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fig</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_ipdf_overlay(options_df, current_price):</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a><span class="co">    Create 2D plot with multiple IPDFs overlaid with alpha transparency</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>    expirations <span class="op">=</span> <span class="bu">sorted</span>(options_df[<span class="st">'expiration'</span>].unique())</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> plt.cm.tab10(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, exp <span class="kw">in</span> <span class="bu">enumerate</span>(expirations[:<span class="dv">8</span>]):</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>        exp_data <span class="op">=</span> options_df[options_df[<span class="st">'expiration'</span>] <span class="op">==</span> exp]</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>        days_to_exp <span class="op">=</span> exp_data[<span class="st">'days_to_exp'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use ATM option IV</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>        atm_option <span class="op">=</span> exp_data.iloc[(exp_data[<span class="st">'strike'</span>] <span class="op">-</span> current_price).<span class="bu">abs</span>().argsort()[:<span class="dv">1</span>]]</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(atm_option) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>            iv <span class="op">=</span> atm_option[<span class="st">'impliedVolatility'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>            price_range, pdf <span class="op">=</span> calculate_probability_distribution(</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>                current_price, current_price, iv, days_to_exp</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> price_range <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>                ax.plot(price_range, pdf, </span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>                       label<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>exp<span class="sc">.</span>strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>days_to_exp<span class="sc">}</span><span class="ss">d)"</span>,</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span>colors[idx <span class="op">%</span> <span class="bu">len</span>(colors)], linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>                ax.fill_between(price_range, pdf, alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span>colors[idx <span class="op">%</span> <span class="bu">len</span>(colors)])</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add vertical line for current price</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>    ax.axvline(x<span class="op">=</span>current_price, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>               label<span class="op">=</span><span class="ss">f'Current: $</span><span class="sc">{</span>current_price<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Implied Probability Distribution Functions - Overlay View'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Stock Price'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Probability Density'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_mode_and_quartiles(options_df, current_price):</span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a><span class="co">    Create chart showing most probable value (mode) and confidence intervals</span></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>    expirations <span class="op">=</span> <span class="bu">sorted</span>(options_df[<span class="st">'expiration'</span>].unique())</span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>    exp_labels <span class="op">=</span> []</span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>    modes <span class="op">=</span> []</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>    q25 <span class="op">=</span> []</span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>    q75 <span class="op">=</span> []</span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>    q5 <span class="op">=</span> []</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>    q95 <span class="op">=</span> []</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>    days_list <span class="op">=</span> []</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> exp <span class="kw">in</span> expirations[:<span class="dv">12</span>]:</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>        exp_data <span class="op">=</span> options_df[options_df[<span class="st">'expiration'</span>] <span class="op">==</span> exp]</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>        days_to_exp <span class="op">=</span> exp_data[<span class="st">'days_to_exp'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>        atm_option <span class="op">=</span> exp_data.iloc[(exp_data[<span class="st">'strike'</span>] <span class="op">-</span> current_price).<span class="bu">abs</span>().argsort()[:<span class="dv">1</span>]]</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(atm_option) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>            iv <span class="op">=</span> atm_option[<span class="st">'impliedVolatility'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>            T <span class="op">=</span> days_to_exp <span class="op">/</span> <span class="fl">365.0</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Mode of lognormal distribution</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>            mode <span class="op">=</span> current_price <span class="op">*</span> np.exp(<span class="op">-</span>iv<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> T)</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate quantiles using lognormal distribution</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>            mu <span class="op">=</span> np.log(current_price) <span class="op">+</span> (<span class="fl">0.05</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> iv<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> T</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>            sigma <span class="op">=</span> iv <span class="op">*</span> np.sqrt(T)</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>            q5_val <span class="op">=</span> np.exp(mu <span class="op">+</span> sigma <span class="op">*</span> norm.ppf(<span class="fl">0.05</span>))</span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>            q25_val <span class="op">=</span> np.exp(mu <span class="op">+</span> sigma <span class="op">*</span> norm.ppf(<span class="fl">0.25</span>))</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>            q75_val <span class="op">=</span> np.exp(mu <span class="op">+</span> sigma <span class="op">*</span> norm.ppf(<span class="fl">0.75</span>))</span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>            q95_val <span class="op">=</span> np.exp(mu <span class="op">+</span> sigma <span class="op">*</span> norm.ppf(<span class="fl">0.95</span>))</span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>            exp_labels.append(<span class="ss">f"</span><span class="sc">{</span>exp<span class="sc">.</span>strftime(<span class="st">'%m/</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>            modes.append(mode)</span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>            q25.append(q25_val)</span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>            q75.append(q75_val)</span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>            q5.append(q5_val)</span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>            q95.append(q95_val)</span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>            days_list.append(days_to_exp)</span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>    x_pos <span class="op">=</span> np.arange(<span class="bu">len</span>(exp_labels))</span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 90% confidence interval</span></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(x_pos, q5, q95, alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">'lightblue'</span>, label<span class="op">=</span><span class="st">'90% CI (5th-95th)'</span>)</span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 50% confidence interval (IQR)</span></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(x_pos, q25, q75, alpha<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'50% CI (25th-75th)'</span>)</span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mode (most probable value)</span></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>    ax.plot(x_pos, modes, <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'darkgreen'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>            markersize<span class="op">=</span><span class="dv">8</span>, label<span class="op">=</span><span class="st">'Most Probable (Mode)'</span>)</span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Current price line</span></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>    ax.axhline(y<span class="op">=</span>current_price, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>               label<span class="op">=</span><span class="ss">f'Current: $</span><span class="sc">{</span>current_price<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Most Probable Value and Confidence Intervals by Expiration'</span>, </span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>                 fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Expiration Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Stock Price'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(x_pos)</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(exp_labels, rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'best'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="9320be3e" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set ticker symbol</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>TICKER <span class="op">=</span> <span class="st">"AAPL"</span>  <span class="co"># Change this to any ticker</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>interest <span class="op">=</span> yf.Ticker(<span class="st">"^IRX"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> interest.history(period<span class="op">=</span><span class="st">"1d"</span>)[<span class="st">"Close"</span>].iloc[<span class="op">-</span><span class="dv">1</span>]<span class="op">/</span><span class="dv">100</span>  <span class="co"># assume risk-free rate ~5% (you could pull ^IRX)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Fetching option chain data for </span><span class="sc">{</span>TICKER<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>options_df, current_price <span class="op">=</span> get_option_chain_data(TICKER)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Current price: $</span><span class="sc">{</span>current_price<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total options loaded: </span><span class="sc">{</span><span class="bu">len</span>(options_df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Expirations available: </span><span class="sc">{</span><span class="bu">len</span>(options_df[<span class="st">'expiration'</span>].unique())<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Fetching option chain data for AAPL...
Current price: $253.34
Total options loaded: 2122
Expirations available: 21</code></pre>
</div>
</div>
<div id="aa16a942" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualizations</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Generating 3D IPDF surface plot..."</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>fig_3d <span class="op">=</span> create_3d_ipdf_surface(options_df, current_price)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>fig_3d.show()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating IPDF overlay plot..."</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>fig_overlay <span class="op">=</span> create_ipdf_overlay(options_df, current_price)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>fig_overlay.show()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating mode and quartiles plot..."</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>fig_quartiles <span class="op">=</span> create_mode_and_quartiles(options_df, current_price)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>fig_quartiles.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Generating 3D IPDF surface plot...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>                            <div id="690f8eba-a762-4425-b7d5-e534a32b3bc1" class="plotly-graph-div" style="height:700px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("690f8eba-a762-4425-b7d5-e534a32b3bc1")) {                    Plotly.newPlot(                        "690f8eba-a762-4425-b7d5-e534a32b3bc1",                        [{"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"name":"Probability Density","opacity":0.8,"x":[230.69680690620186,230.9243766492339,231.15194639226596,231.379516135298,231.60708587833005,231.8346556213621,232.06222536439415,232.2897951074262,232.51736485045825,232.74493459349029,232.97250433652235,233.20007407955438,233.42764382258642,233.65521356561848,233.88278330865052,234.11035305168258,234.33792279471461,234.56549253774668,234.7930622807787,235.02063202381078,235.2482017668428,235.47577150987487,235.7033412529069,235.93091099593897,236.158480738971,236.38605048200304,236.6136202250351,236.84118996806714,237.0687597110992,237.29632945413124,237.5238991971633,237.75146894019534,237.9790386832274,238.20660842625944,238.4341781692915,238.66174791232353,238.88931765535557,239.11688739838763,239.34445714141967,239.57202688445173,239.79959662748377,240.02716637051583,240.25473611354786,240.48230585657993,240.70987559961196,240.93744534264403,241.16501508567606,241.3925848287081,241.62015457174016,241.8477243147722,242.07529405780426,242.3028638008363,242.53043354386836,242.7580032869004,242.98557302993245,243.2131427729645,243.44071251599655,243.6682822590286,243.89585200206062,244.12342174509268,244.35099148812472,244.57856123115678,244.80613097418882,245.03370071722088,245.26127046025292,245.48884020328498,245.71640994631701,245.94397968934908,246.1715494323811,246.39911917541318,246.6266889184452,246.85425866147727,247.0818284045093,247.30939814754134,247.5369678905734,247.76453763360544,247.9921073766375,248.21967711966954,248.4472468627016,248.67481660573364,248.90238634876567,249.12995609179774,249.3575258348298,249.58509557786184,249.81266532089387,250.04023506392593,250.26780480695797,250.49537454999003,250.72294429302207,250.95051403605413,251.17808377908617,251.40565352211823,251.63322326515026,251.86079300818233,252.08836275121436,252.3159324942464,252.54350223727846,252.7710719803105,252.99864172334256,253.2262114663746,253.45378120940666,253.6813509524387,253.90892069547075,254.1364904385028,254.36406018153485,254.5916299245669,254.81919966759892,255.046769410631,255.27433915366302,255.50190889669508,255.72947863972712,255.95704838275918,256.18461812579125,256.41218786882325,256.6397576118553,256.8673273548874,257.09489709791944,257.32246684095145,257.5500365839835,257.7776063270156,258.0051760700476,258.23274581307965,258.4603155561117,258.6878852991438,258.9154550421758,259.14302478520784,259.3705945282399,259.5981642712719,259.825734014304,260.05330375733604,260.2808735003681,260.5084432434001,260.7360129864322,260.96358272946424,261.1911524724963,261.4187222155283,261.64629195856037,261.87386170159243,262.1014314446245,262.3290011876565,262.55657093068857,262.78414067372063,263.01171041675263,263.2392801597847,263.46684990281676,263.6944196458488,263.92198938888083,264.1495591319129,264.37712887494496,264.60469861797696,264.832268361009,265.0598381040411,265.28740784707315,265.5149775901052,265.7425473331372,265.9701170761693,266.19768681920135,266.42525656223336,266.6528263052654,266.8803960482975,267.10796579132955,267.33553553436155,267.5631052773936,267.7906750204257,268.0182447634577,268.24581450648975,268.4733842495218,268.7009539925539,268.9285237355859,269.15609347861795,269.38366322165,269.6112329646821,269.8388027077141,270.06637245074614,270.2939421937782,270.52151193681027,270.7490816798423,270.97665142287434,271.2042211659064,271.4317909089384,271.6593606519705,271.88693039500254,272.1145001380346,272.3420698810666,272.56963962409867,272.79720936713073,273.02477911016274,273.2523488531948,273.47991859622687,273.70748833925893,273.93505808229094,274.162627825323,274.39019756835506,274.6177673113871,274.84533705441913,275.0729067974512,275.30047654048326,275.5280462835153,275.75561602654733,275.9831857695794],"y":[0,1,2,3,4,5,6,7],"z":[[1.1764765146104898e-05,1.4128235530088401e-05,1.693050644356243e-05,2.02456617781321e-05,2.415887166951091e-05,2.8767795677983567e-05,3.41841205413571e-05,4.05352385133297e-05,4.7966071404549877e-05,5.664104430755277e-05,6.674621158961417e-05,7.849153605848798e-05,9.21133202291502e-05,0.00010787678632891494,0.0001260787990646825,0.0001470507222326829,0.00017116139697804722,0.00019882022591508788,0.00023048034341260052,0.0002666418481531255,0.0003078550696221196,0.0003547238355111551,0.0004079087021792689,0.0004681301053684065,0.0005361713833832397,0.0006128816200047771,0.0006991782495983867,0.0007960493623096037,0.0009045556430144078,0.0010258318739298155,0.0011610879276175913,0.001311609174650142,0.0014787562285914517,0.0016639639503012182,0.001868739634023698,0.0020946602993891345,0.0023433690164656176,0.002616570195415167,0.0029160237782527966,0.0032435382777088162,0.0036009626173196425,0.003990176737611816,0.004413080945614778,0.004871583998843192,0.0053675899303317585,0.005902983638060747,0.006479615280163625,0.007099283536331204,0.007763717815725466,0.00847455951216707,0.009233342428066211,0.010041472509287478,0.010900207053458306,0.011810633573816762,0.012773648519201819,0.013789936067794115,0.014859947227371904,0.015983879487728208,0.017161657281236444,0.018392913514887133,0.01967697244126247,0.021012834136478836,0.022399160850035925,0.023834265484397828,0.025316102451068263,0.026842261134783583,0.028409962178162648,0.03001605677601683,0.0316570291415375,0.033329002275980346,0.03502774713973752,0.03674869528595941,0.038486954978855,0.04023733077778379,0.04199434652586038,0.04375227163876656,0.04550515054616584,0.0472468350954672,0.04897101968623173,0.050671278863909465,0.05234110706453766,0.05397396016818551,0.05556329848880376,0.05710263080229281,0.05858555899362317,0.060005822887959095,0.06135734482045398,0.06263427349482038,0.06383102668214552,0.06494233231878713,0.06596326757540763,0.06688929548830262,0.06771629876873042,0.06844061043579554,0.06905904095300955,0.06956890158757559,0.06996802375405599,0.07025477414981852,0.07042806553780744,0.07048736308204595,0.07043268619210884,0.070264605883874,0.06998423771439652,0.06959323039805466,0.06909375025847782,0.0684884617155209,0.06778050404811403,0.06697346471161936,0.06607134952192152,0.0650785500474536,0.06399980857438249,0.06284018102909189,0.061604998255635965,0.06029982605409013,0.05893042438859159,0.05750270617156225,0.05602269602323846,0.05449648939356516,0.05293021241694473,0.051329982849816075,0.04970187241680507,0.048051870863942636,0.04638585198746116,0.04470954187469745,0.043028489559966056,0.04134804026365255,0.03967331134764852,0.03800917108499533,0.036360220307035424,0.03473077695752683,0.03312486355083349,0.03154619750056578,0.02999818425645656,0.02848391316089163,0.027006155912752166,0.025567367505185585,0.024169689485680247,0.02281495537156037,0.021504698041624904,0.020240158915253402,0.019022298723702483,0.01785180967449776,0.01672912880865169,0.015654452351620975,0.014627750862542862,0.013648784991742562,0.012717121664025223,0.011832150514181407,0.01099310041156141,0.010199055922022505,0.00944897356791818,0.008741697759819103,0.00807597628706475,0.007450475267908762,0.006863793473675576,0.00631447595483349,0.005801026910098133,0.005321921752356065,0.004875618337350208,0.004460567332482302,0.004075221713749639,0.0037180453886419326,0.003387520951750819,0.0030821565878436457,0.0028004921442272134,0.0025411044003671697,0.002302611567944491,0.0020836770588619526,0.001883012562178432,0.0016993804736045559,0.0015315957230878376,0.0013785270471934478,0.0012390977535289961,0.0011122860244078868,0.0009971248063838033,0.0008927013312560709,0.0007981563127304942,0.0007126828611697503,0.0006355251568414415,0.0005659769198358928,0.0005033797124198183,0.000447121107078064,0.00039663275090394217,0.0003513883543851869,0.00031090163001811925,0.0002747242036102709,0.00024244351862026897,0.00021368075146257855,0.000188088753385842,0.00016535003233881986,0.00014517478617252514,0.00012729899660469254,0.00011148259159320262,9.750768213607533e-05,8.517687803351522e-05,7.431168581234405e-05,6.475099082192027e-05,5.6349624456104676e-05,4.897701653507004e-05,4.2515932083570424e-05],[3.4182067402620775e-06,4.1985211440511965e-06,5.1432117119285725e-06,6.2837485053138915e-06,7.656949430649318e-06,9.305753950843934e-06,1.1280083747519367e-05,1.3637795769143851e-05,1.6445732679785684e-05,1.9780875133027565e-05,2.3731599516519674e-05,2.8399043826418752e-05,3.389858312074317e-05,4.0361414551879093e-05,4.793625027894959e-05,5.679111460251701e-05,6.711523944284385e-05,7.912104979995742e-05,9.304622809620688e-05,0.00010915584332321312,0.00012774452771639454,0.0001491386802906524,0.0001736986730264584,0.00020182103184425643,0.0002339405607992757,0.00027053237423374537,0.0003121137980093743,0.0003592460974905311,0.00041253598674341436,0.0004726368705515857,0.0005402497684207061,0.0006161238678532195,0.0007010566529208142,0.0007958935536433,0.0009015270619989106,0.0010188952616236179,0.001148979720497135,0.0012928026992174364,0.0014514236318987487,0.0016259348423195714,0.001817456464718742,0.0020271305465837408,0.0022561143198679173,0.0025055726372568486,0.0027766695813055634,0.003070559266366947,0.003388375866113878,0.0037312229129389672,0.00410016192943538,0.004496200466290551,0.004920279635048096,0.005373261238059258,0.005855914611298784,0.00636890330829084,0.0069127717649104595,0.007487932095033246,0.008094651175626999,0.00873303818667829,0.009403032776100238,0.010104394022254295,0.010836690366802638,0.011599290688103146,0.012391356680239683,0.013211836694919422,0.014059461192937583,0.014932739938682112,0.01582996105541126,0.016749192040825964,0.017688282822083,0.01864487090701667,0.019616388664281337,0.02060007273973766,0.021592975589994175,0.022591979087028858,0.02359381012064852,0.024595058098585188,0.025592194217796134,0.026581592355353775,0.0275595514037124,0.0285223188534123,0.029466115406913504,0.030387160390479537,0.031281697717228066,0.032146022143858116,0.032976505556323164,0.033769623016046114,0.034521978298208224,0.03523032865720099,0.03589160856153002,0.03650295215112331,0.03706171418403245,0.03756548925665577,0.03801212910164123,0.038399757790189656,0.038726784690236785,0.038991915058590385,0.03919415817306306,0.03933283293961426,0.03940757093899625,0.0394183169069924,0.039365326671581866,0.039249162598849245,0.03907068662678545,0.03883105099191651,0.038531686777618666,0.03817429043472007,0.03776080844431321,0.037293420309364035,0.03677452007558044,0.03620669659293982,0.03559271273724058,0.03493548381599815,0.03423805538499883,0.03350358070092309,0.03273529803178007,0.031936508040605556,0.031110551449168033,0.030260787177526817,0.029390571142398753,0.028503235882756245,0.027602071165082887,0.026690305703617023,0.0257710901129681,0.024847481191977452,0.023922427618917014,0.022998757119342565,0.022079165149358565,0.02116620511900756,0.02026228016312191,0.01936963645051168,0.018490358006945113,0.017626363013151587,0.01677940152617584,0.01595105456090431,0.015142734458537956,0.01435568646023452,0.01359099139711248,0.01284956940225947,0.012132184546326688,0.011439450295623361,0.010771835690323285,0.010129672140358068,0.009513160737696045,0.008922379985919835,0.008357293851168863,0.007817760042533064,0.007303538434706565,0.006814299551069898,0.006349633031186755,0.005909056012935014,0.005492021365951443,0.005097925719730521,0.004726117236417326,0.004375903085025894,0.004046556580399319,0.0037373239566278324,0.0034474307508181867,0.0031760877789698016,0.002922496691259812,0.0026858550991906436,0.0024653612718172225,0.0022602184026076144,0.0020696384523960147,0.001892845577353376,0.0017290791539329186,0.0015775964153516317,0.0014376747163526557,0.0013086134447839854,0.0011897355999324491,0.0010803890586056635,0.0009799475506715766,0.0008878113661824915,0.0008034078163472486,0.000726191470506291,0.0006556441909357824,0.0005912749867870728,0.0005326197077827387,0.0004792405974712034,0.0004307257249077659,0.0003866883126081307,0.00034676597753421196,0.00031061990073668217,0.00027793394011881576,0.0002484136996127302,0.00022178556689202847,0.00019779573059192302,0.0001762091868846131,0.00015680874417047948,0.00013939403360345838,0.00012378053217801673,0.00010979860416937448,9.729256584287195e-05,8.611977753314658e-05,7.614976644203724e-05,6.726338281502456e-05,5.935199152916911e-05,5.231670056029203e-05,4.606762729088913e-05,4.0523203171397964e-05,3.5609516852770066e-05],[1.603999937317728e-06,2.005597778862585e-06,2.4998908511423324e-06,3.1063182904089923e-06,3.847941427009171e-06,4.752020923449332e-06,5.850666439676915e-06,7.1815643520227855e-06,8.788788821428754e-06,1.0723701125454448e-05,1.304594161697635e-05,1.582451793059802e-05,1.913899210693854e-05,2.3080768128159907e-05,2.7754479940864688e-05,3.327947837367408e-05,3.979141342947713e-05,4.74439062441972e-05,5.6410302559225006e-05,6.688549686336808e-05,7.908781344049562e-05,9.326092743663271e-05,0.00010967580576963948,0.00012863264428873453,0.00015046277410299709,0.0001755305064975783,0.00020423488241502012,0.00023701128917325844,0.0002743329040072205,0.0003167119212479464,0.00036470051758687253,0.0004188915080108211,0.00047991864373441784,0.0005484565028950039,0.0006252199250063506,0.0007109629412722174,0.0008064771549175386,0.0009125895287649038,0.0010301595414132962,0.0011600756785977394,0.0013032512326257729,0.0014606193901936892,0.0016331275973382213,0.0018217311997195183,0.0020273863667697608,0.002251042319364018,0.0024936328924326885,0.0027560674761826272,0.0030392213921310402,0.0033439257727770886,0.0036709570262290206,0.004021025979214326,0.004394766803404186,0.004792725840610232,0.005215350451943327,0.005662978024189343,0.006135825273260204,0.006633977989387332,0.0071573813715701045,0.007705831099510149,0.008278965289736664,0.008876257478760554,0.009497010769870187,0.010140353271553722,0.01080523494460279,0.011490425961747791,0.012194516668397432,0.012915919215820727,0.013652870919192357,0.014403439372549343,0.01516552933119105,0.01593689134969894,0.016715132140935673,0.01749772659842499,0.018282031401833907,0.019065300103206846,0.019844699570540907,0.020617327645581468,0.021380231854703124,0.022130428995729298,0.022864925409812185,0.023580737736293104,0.02427491393997397,0.024944554394615653,0.02558683280383375,0.026199016740934698,0.026778487592625463,0.027322759697884582,0.027829498482481053,0.028296537401539913,0.02872189351696155,0.029103781553172014,0.02944062629334465,0.029731073198583022,0.029973997154254434,0.030168509270384142,0.030313961686391486,0.0304099503541227,0.030456315796745893,0.030453141864285434,0.03040075252903754,0.03029970678553544,0.030150791739815545,0.029955013991235006,0.029713589426774788,0.029427931562449293,0.029099638578983598,0.02873047920920506,0.028322377642562128,0.027877397617787365,0.02739772587799651,0.026885655163478503,0.026343566916179065,0.025773913866528036,0.025179202667914877,0.024561976736990516,0.02392479944918776,0.02327023782866768,0.022600846860459173,0.021919154540156735,0.021227647763308887,0.020528759142879785,0.019824854829034993,0.019118223391253835,0.018411065808583094,0.017705486599888832,0.01700348611245508,0.01630695397431263,0.015617663703442265,0.014937268455581654,0.014267297881864238,0.01360915605802176,0.012964120438446922,0.01233334178106015,0.011717844982688982,0.011118530759557438,0.010536178103456336,0.009971447441229419,0.00942488442328595,0.008896924265921627,0.008387896572204467,0.007898030557005598,0.0074274606033430095,0.006976232079488758,0.006544307349163148,0.006131571910542868,0.005737840603633932,0.005362863829746361,0.005006333731243999,0.0046678902843892405,0.004347127262847537,0.00404359803422072,0.0037568211567661153,0.0034862857481722884,0.00323145660285968,0.0029917790387016517,0.002766683458289847,0.0025555896138602374,0.002357910568730535,0.002173056351552439,0.0020004373028487594,0.0018394671161667468,0.0016895655787362073,0.001550161018779976,0.0014206924685766554,0.0013006115540457263,0.0011893841230063615,0.0010864916253835975,0.0009914322595009828,0.0009037218992324573,0.0008228948172022503,0.0007485042194392179,0.0006801226069322243,0.0006173419794124917,0.0005597738964284637,0.0005070494103959642,0.000458818885821122,0.00041475171831996394,0.00037453596641637363,0.00033787790840186354,0.0003045015358024363,0.0002741479942308486,0.00024657498162007375,0.00022155611304552084,0.0001988802605586723,0.00017835087568178942,0.0001597853014594035,0.00014301408023218245,0.00012788026259891825,0.00011423872236520376,0.00010195548164688097,9.090704970416853e-05,8.097977853016283e-05,7.206923770594456e-05,6.407961056398748e-05,5.692311327148282e-05,5.051943805523147e-05,4.479522143841275e-05,3.968353804546648e-05,3.5123420253210096e-05],[8.531634701615561e-07,1.084977814310266e-06,1.3748115994809658e-06,1.735854923136921e-06,2.1839645825806456e-06,2.738126717222457e-06,3.420983503131072e-06,4.2594295975008005e-06,5.285283939216871e-06,6.536042281466538e-06,8.055715441299625e-06,9.895757677235281e-06,1.211608882816299e-05,1.4786212845100667e-05,1.7986434104312447e-05,2.1809171391423536e-05,2.6360367681311377e-05,3.176099180233803e-05,3.814862576681482e-05,4.567912898014225e-05,5.452836772433354e-05,6.489399527173421e-05,7.699726475481702e-05,9.108485354072982e-05,0.00010743067438732193,0.0001263376451525101,0.0001481393853630401,0.0001732018046011369,0.00020192454452667877,0.00023474223351146602,0.0002721255104198382,0.0003145817721267669,0.00036265559802247743,0.00041692880410942884,0.0004780200794486526,0.0005465841587413164,0.0006233104868164274,0.000708921333793665,0.0008041693237498226,0.0009098343448596935,0.0010267198152141826,0.0011556482858142388,0.001297456370560416,0.0014529890023228518,0.0016230930242970125,0.001808610136690359,0.002010369230204108,0.002229178149589845,0.0024658149425838636,0.0027210186615329187,0.0029954797968046835,0.003289830432375832,0.0036046342245802964,0.003940376314622184,0.004297453293895764,0.004676163348158054,0.00507669671198605,0.00549912656851202,0.005943400531023346,0.006409332842506032,0.00689659742651089,0.007404721917786173,0.007933082793936255,0.00848090171996997,0.009047243206076187,0.009631013665434006,0.010230961943494916,0.010845681373169982,0.011473613391975609,0.012113052737680322,0.012762154218702753,0.013418941034714664,0.014081314601982389,0.014747065817249301,0.015413887673806389,0.01607938912412649,0.016741110065402534,0.017396537307836496,0.018043121370856532,0.01867829393985131,0.01929948580570922,0.01990414510163201,0.02048975564646596,0.021053855201252945,0.021594053445892696,0.02210804948569972,0.02259364870318623,0.023048778778494306,0.023471504712398637,0.023860042698498684,0.024212772705920985,0.02452824965028042,0.024805213048538704,0.025042595072453704,0.02523952693521203,0.025395343566277356,0.02550958655013844,0.02558200532519189,0.025612556659147752,0.025601402436804904,0.025548905814545313,0.02545562581319721,0.025322310436799736,0.025149888419082205,0.024939459711997975,0.024692284841304517,0.02440977326287815,0.02409347086014133,0.023745046727650262,0.023366279388553617,0.02295904259434388,0.022525290854151975,0.022067044837885984,0.021586376792915758,0.02108539610789165,0.020566235149824672,0.02003103549191505,0.019481934639974392,0.01892105335483546,0.01835048365705615,0.01777227758870498,0.017188436795225418,0.016600902978499556,0.016011549260434476,0.015422172484816652,0.014834486473975117,0.014250116246074975,0.013670593188747474,0.013097351175332016,0.012531723601354185,0.011974941311025788,0.011428131376597742,0.010892316687337082,0.010368416299741348,0.009857246496376367,0.009359522497369818,0.008875860766129902,0.008406781849219636,0.007952713689470852,0.007513995351324673,0.00709088109795431,0.006683544760929201,0.006292084344926218,0.005916526812235375,0.0055568329944571575,0.005212902581798957,0.004884579143665835,0.004571655137744878,0.004273876868454608,0.0039909493593882715,0.0037225411081934718,0.003468288696135195,0.003227801228343827,0.0030006645844212546,0.0027864454626154913,0.002584695204172093,0.0023949533876757496,0.002216751186213103,0.0020496144829858748,0.0018930667435772639,0.0017466316454171958,0.0016098354670986972,0.0014822092420667162,0.0013632906828399067,0.001252625883334506,0.0011497708080513694,0.0010542925778667992,0.0009657705629502293,0.0008837972939281099,0.000807979202836521,0.0007379372056692175,0.0006733071384495239,0.0006137400587446336,0.0005589024244176032,0.0005084761611868368,0.00046215863025207845,0.00041966250685998525,0.0003807155802356357,0.0003450604848112211,0.0003124543721488017,0.0002826685323922006,0.00025548797350226197,0.00023071096593882076,0.0002081485598587126,0.0001876240813088444,0.0001689726133128357,0.00015204046718324713,0.00013668464884375608,0.0001227723244197739,0.00011018028885493607,9.879444083660138e-05,8.850926686740467e-05,7.922733690331353e-05,7.085881359176551e-05,6.332097678659036e-05,5.6537764689499064e-05,5.043933266993443e-05,4.496163054585138e-05,4.004599886607072e-05,3.563878451919095e-05],[2.226695626414026e-07,2.95560077650195e-07,3.9038099504852206e-07,5.131187484088427e-07,6.71214423342892e-07,8.738688167766897e-07,1.1323995548242956e-06,1.4606564815024198e-06,1.8755017130892058e-06,2.397360813422121e-06,3.0508514555068714e-06,3.8654956649952765e-06,4.876521261632476e-06,6.125757396580111e-06,7.662628099272246e-06,9.545246472859243e-06,1.184161059244163e-05,1.463090025098786e-05,1.800487145719767e-05,2.2069343019184337e-05,2.6945766659342324e-05,3.277286892169006e-05,3.9708349687986284e-05,4.793061846020386e-05,5.764054575476837e-05,6.90632030612545e-05,8.244956093055321e-05,9.807811097126319e-05,0.00011625637395516822,0.00013732225297689233,0.00016164518779947424,0.00018962706426826299,0.00022170283111185214,0.000258340775687195,0.00030004241037557373,0.00034734192249264047,0.00040080514281995433,0.00046102799125763894,0.0005286343626757947,0.0006042734218159656,0.0006886162830476815,0.0007823520588682605,0.000886183270169676,0.0010008206213701415,0.001126977154381228,0.0012653618068784868,0.001416672412270586,0.0015815881908931646,0.001760761794053869,0.0019548109743653605,0.002164309967066825,0.0023897806774836328,0.0026316837791549165,0.002890409835219462,0.0031662705621638017,0.003459490359797115,0.003770198234151642,0.004098420240774262,0.004444072574475343,0.004806955427979006,0.005186747736065228,0.005583002913742648,0.005995145686829757,0.006422470101176702,0.006864138782814175,0.007319183505768829,0.0077865071074112845,0.008264886773261749,0.008752978694497171,0.009249324082295821,0.009752356503969897,0.01026041048689766,0.010771731317938717,0.011284485948593242,0.0117967748999882,0.012306645047104943,0.012812103148762603,0.013311129978968647,0.013801694906503273,0.014281770763175498,0.014749348837149127,0.015202453826148316,0.01563915858620049,0.016057598514829963,0.016455985413175323,0.016832620679250548,0.017185907694334313,0.017514363276057744,0.01781662808494213,0.01809147588567329,0.01833782158001705,0.01855472794471188,0.018741411024641056,0.018897244148801895,0.01902176055378947,0.01911465461642066,0.0191757817135089,0.019205156742412962,0.01920295135063436,0.019169489936231965,0.019105244493013776,0.019010828385221914,0.018886989145655717,0.018734600398809337,0.018554653016598394,0.018348245618605475,0.01811657453150368,0.017860923323463996,0.017582652028981887,0.017283186177754466,0.01696400573810977,0.016626634081145175,0.016272627066308658,0.015903562342788325,0.015521028953907048,0.015126617323899904,0.014721909698123538,0.014308471099060185,0.013887840851568573,0.013461524721841877,0.013030987705572579,0.012597647492027464,0.012162868622192622,0.011727957350966177,0.011294157215624424,0.010862645305547374,0.01043452922150649,0.010010844706743101,0.00959255392662801,0.009180544368917626,0.00877562833250719,0.00837854296913981,0.00798995083974362,0.007610440944918681,0.007240530187563131,0.006880665224669975,0.006531224664919042,0.006192521568779067,0.005864806208390257,0.005548269045456344,0.005243043886711211,0.004949211178162724,0.004666801401237145,0.0043957985360784935,0.0041361435595700675,0.0038877379480900297,0.0036504471575481683,0.0034241040558409203,0.0032085122854711126,0.0030034495366712756,0.0028086707139267715,0.002623910981277977,0.0024488886741812444,0.0022833080679994775,0.0021268619953624312,0.0019792343066728,0.0018401021699265764,0.0017091382077607964,0.001586012471230143,0.001470394251250677,0.0013619537299296987,0.0012603634751295104,0.0011652997825944698,0.0010764438708088925,0.0009934829344540894,0.0009161110629071777,0.0008440300306737204,0.0007769499669859827,0.0007145899120332531,0.000656678267430308,0.0006029531485849605,0.0005531626466033158,0.0005070650072816379,0.0004644287345850118,0.00042503262581308684,0.0003886657454115234,0.0003551273441088964,0.0003242267297535349,0.0002957830958954295,0.00026962531381458744,0.0002455916933410669,0.00022352971745108734,0.00020329575526024853,0.0001847547576738907,0.00016777993959900348,0.00015225245227479982,0.00013806104894192536,0.0001251017467462645,0.00011327748746296258,0.00010249779933152795,9.267846201441641e-05,8.374117642972307e-05,7.561324096449555e-05,6.822723534792262e-05,6.15207132543236e-05,5.543590451307492e-05,4.991942762697025e-05,4.492201314078764e-05,4.0398238257859556e-05,3.630627297329286e-05],[1.094146113331574e-07,1.4888860432704484e-07,2.0143892413562826e-07,2.709941327312299e-07,3.6253415415103713e-07,4.823338438500516e-07,6.382529021791193e-07,8.400785127630022e-07,1.0999274231309408e-06,1.432714414635534e-06,1.8566941996444241e-06,2.3940837022624557e-06,3.0717713892643677e-06,3.922119785136354e-06,4.9838664949168755e-06,6.303127939232799e-06,7.934508550089261e-06,9.94231636208808e-06,1.2401883747964239e-05,1.5400989485354284e-05,1.9041375410321488e-05,2.3440347631884744e-05,2.8732448683985753e-05,3.507118312529919e-05,4.263077502644998e-05,5.160793158761841e-05,6.222358290058402e-05,7.47245637153875e-05,8.938519911200402e-05,0.00010650875234020151,0.00012642868991116755,0.0001495097164406075,0.00017614852989170597,0.0002067742468793866,0.00024184844769668394,0.0002818647918167469,0.0003273481568989183,0.00037885325784856196,0.00043696270728660883,0.0005022844848819386,0.0005754487903626868,0.0006571042635895096,0.000747913564747987,0.0008485483183670765,0.0009596834363279597,0.0010819908470970307,0.0012161326708703263,0.0013627538929056441,0.0015224745997773398,0.0016958818553350124,0.0018835213045024883,0.0020858886034303514,0.0023034207836496647,0.0025364876655052985,0.002785383442052157,0.003050318558571935,0.003331412014756202,0.003628684216280348,0.0039420504998911214,0.004271315451225388,0.004616168127392523,0.004976178286969194,0.00535079371859575,0.0057393387460046895,0.006141013972275065,0.006554897309637032,0.006979946323553151,0.007415001901383588,0.00785879323703439,0.008309944103948405,0.008766980369967816,0.009228338689322256,0.009692376289619295,0.01015738175553657,0.010621586696235292,0.011083178170584025,0.011540311733321608,0.01199112495647305,0.012433751273803292,0.012866333991923792,0.0132870403099213,0.013694075190018558,0.014085694924784302,0.014460220251667055,0.01481604887301183,0.01515166724905916,0.01546566154251956,0.01575672760594149,0.01602367991699382,0.016265459381711703,0.016481139941430887,0.016669933935286305,0.01683119618651103,0.01696442679706812,0.017069272651137092,0.01714552764341508,0.017193131662870835,0.01721216837631054,0.017202861868712165,0.017165572208618404,0.017100790016837064,0.017009130125195948,0.016891324419084565,0.016748213962958582,0.01658074051188603,0.01638993751460045,0.01617692071444352,0.015942878454097757,0.01568906178821226,0.015416774505017418,0.015127363153916832,0.014822207170966821,0.014502709188230527,0.014170285606365999,0.013826357502606617,0.013472341938658433,0.013109643725103367,0.012739647690786136,0.012363711497500008,0.011983159032183653,0.011599274400899426,0.011213296541181337,0.010826414461994279,0.010439763113608362,0.010054419883226353,0.009671401706245518,0.009291662777637847,0.008916092843106687,0.008545516045448984,0.00818069029791823,0.007822307153347304,0.007470992135335021,0.007127305495911658,0.006791743362752974,0.006464739238170904,0.006146665811754488,0.005837837048609015,0.005538510515625833,0.0052488899090505714,0.004969127747772708,0.004699328198187698,0.004439549998143645,0.0041898094493337205,0.003950083449497878,0.003720312537915499,0.003500403929860533,0.0032902345179354215,0.0030896538204529577,0.002898486859279783,0.0027165369517652502,0.0025435884035289362,0.002379409090957487,0.002223752924245736,0.002076362183698395,0.0019369697237762121,0.0018053010410165275,0.0016810762034763244,0.0015640116407352475,0.0014538217947539101,0.0013502206330073985,0.001252923026313396,0.0011616459946430754,0.0010761098249547733,0.000996039065722209,0.0009211634033534161,0.0008512184261153726,0.0007859462815033673,0.0007250962332275822,0.0006684251241425515,0.0006156977515235837,0.000566687161107011,0.0005211748662641769,0.0004789509985810183,0.0004398143959722489,0.00040357263427742566,0.00037004200807338685,0.0003390474661978929,0.00031042250721955035,0.00028400903981297887,0.00025965721271152894,0.00023722521861563276,0.00021657907613758685,0.00019759239356610924,0.0001801461179390881,0.00016412827262352278,0.0001494336863194759,0.0001359637161316407,0.00012362596708960762,0.00011233401024703431,0.0001020071012517012,9.256990105323666e-05,8.39522002040974e-05,7.608864801170771e-05,6.891848761618316e-05,6.238529789839698e-05,5.643674296698056e-05,5.1024329830205674e-05,4.610317472877247e-05,4.163177848812188e-05,3.7571811143275333e-05],[4.457595220215766e-08,6.269484493812689e-08,8.756868084854073e-08,1.2148053879395767e-07,1.6740151210867778e-07,2.2917084642154474e-07,3.11715218587391e-07,4.2131352865308246e-07,5.659140995270729e-07,7.555116227383901e-07,1.0025915182364743e-06,1.3226495527624036e-06,1.734794543211907e-06,2.262441715171323e-06,2.934103748716725e-06,3.7842856813269763e-06,4.854488612485445e-06,6.1943255329199015e-06,7.862750558021677e-06,9.929400364573575e-06,1.2476043709778649e-05,1.559813156361699e-05,1.9406436638069356e-05,2.4028766995934166e-05,2.961173403267022e-05,3.632255053088499e-05,4.435082979116727e-05,5.391035216469907e-05,6.524076078758757e-05,7.860914409166206e-05,9.431145889788704e-05,0.00011267374474761595,0.00013405307775400956,0.00015883821081604725,0.00018744984667384756,0.00022034049112313684,0.00025799383585199464,0.00030092362389021583,0.0003496719556141305,0.0004048069996336385,0.00046692008067136245,0.0005366221256513103,0.0006145394595322238,0.0007013089537899939,0.0007975725426812084,0.0009039711352743666,0.0010211379644557161,0.0011496914274187078,0.0012902274852272147,0.0014433117015897575,0.0016094710126838127,0.0017891853304179194,0.001982879090627269,0.002190912865098152,0.002413575161776842,0.002651074540844924,0.0029035321753883275,0.0031709749840505507,0.003453329459302406,0.0037504163087876577,0.004061946018684715,0.004387515437283613,0.004726605464184568,0.005078579915906691,0.005442685622511502,0.00581805379240769,0.006203702664125295,0.006598541444899072,0.00700137551672789,0.007410912871557968,0.007825771718731516,0.008244489190191192,0.008665531052474397,0.009087302319553476,0.009508158647355689,0.0099264183795455,0.010340375105059826,0.010748310581076418,0.011148507870669322,0.011539264542379838,0.01191890577931341,0.01228579724808923,0.012638357582931012,0.012975070347244206,0.01329449534400489,0.013595279156983789,0.013876164817006258,0.014136000500868072,0.014373747184909745,0.014588485190344303,0.0147794195729479,0.014945884325408271,0.015087345376210428,0.01520340238418894,0.015293789342560421,0.015358374020163513,0.015397156280599185,0.015410265331821606,0.01539795596935652,0.01536060388561685,0.015298700125674915,0.015212844776292579,0.015103739979988378,0.014972182369442328,0.014819055019636755,0.014645319015857722,0.014452004735107701,0.014240202936695888,0.014011055754875308,0.013765747682502915,0.01350549662992449,0.013231545137759405,0.012945151816107128,0.012647583076046038,0.012340105212272327,0.012023976888452375,0.01170044206945864,0.011370723437226128,0.011036016319618442,0.010697483154506934,0.01035624850433886,0.010013394629861875,0.009669957625450835,0.009326924112695003,0.008985228483589819,0.0086457506798689,0.008309314490726392,0.007976686347427962,0.007648574590096459,0.007325629179272723,0.007008441822690878,0.006697546486042125,0.006393420255316395,0.006096484517573399,0.0058071064266768425,0.005525600620590656,0.005252231157249912,0.004987213636745021,0.004730717478555956,0.004482868323809955,0.004243750533970801,0.004013409758968186,0.0037918555495034534,0.003579063990095759,0.003374980331326001,0.0031795216016676097,0.002992579181239808,0.0028140213217542256,0.0026436955988306445,0.0024814312847147037,0.0023270416312221706,0.002180326054450184,0.002041072214421965,0.0019090579843632123,0.0017840533057355075,0.0016658219264721204,0.0015541230210727596,0.001448712692311453,0.0013493453553010187,0.001255775005535798,0.0011677563733063481,0.0010850459675493095,0.0010074030127662787,0.0009345902831218315,0.0008663748382206543,0.0008025286653695065,0.0007428292333608467,0.0006870599629756547,0.0006350106194997423,0.0005864776325881384,0.0005412643488006643,0.0004991812220755194,0.0004600459473117773,0.0004236835421022114,0.00038992638149930385,0.0003586141905152692,0.00032959399885548654,0.0003027200621681933,0.0002778537538656314,0.00025486343133640597,0.00023362428012869434,0.00021401813944220966,0.00019593331202552163,0.00017926436133703372,0.0001639118985941725,0.00014978236210799276,0.0001367877910803112,0.00012484559582941895,0.00011387832620842062,0.00010381343978872602,9.458307119997505e-05,8.612380384749824e-05,7.837644506912067e-05,7.128580564505431e-05,6.48004844372292e-05,5.887265880813153e-05,5.3457881353113294e-05,4.851488337450579e-05,4.40053854298021e-05,3.989391519960312e-05],[4.0441647235442544e-09,6.2927746073021674e-09,9.683772827312392e-09,1.4742209583718951e-08,2.2208449810043694e-08,3.3115360517458983e-08,4.88888917402825e-08,7.147767175887795e-08,1.0351813974183638e-07,1.4854266235392078e-07,2.1123898837626666e-07,2.977702407154161e-07,4.161653728404495e-07,5.76790562747208e-07,7.92912311100031e-07,1.081362975562732e-06,1.4633190329486727e-06,1.9652014388613857e-06,2.6197059810023447e-06,3.4669694377947918e-06,4.555874614175071e-06,5.945493907167111e-06,7.706666955543173e-06,9.923703179340027e-06,1.2696194676552802e-05,1.6140919109741967e-05,2.0393806012159284e-05,2.5611933531856e-05,3.1975516203697474e-05,3.968983810965387e-05,4.898707999313502e-05,6.0127983781707196e-05,7.340329379569383e-05,8.913491092309769e-05,0.00010767669445259534,0.00012941484627764974,0.0001547678139812209,0.00018418565300081522,0.00021814879372360926,0.00025716616697648274,0.0003017726508982074,0.0003525258134875837,0.00041000193802343075,0.0004747913328014454,0.0005474929419225219,0.000628708289845613,0.0007190348086933561,0.0008190586134538207,0.0009293468058263405,0.0010504394020818138,0.0011828409935316368,0.0013270122596341684,0.0014833614630627432,0.0016522360629157896,0.00183391458642793,0.002028598900871606,0.0022364070257246678,0.0024573666205996046,0.00269140927694444,0.0029383657312636383,0.0031979621047755137,0.003469817259289271,0.00375344134197408,0.004048235572978765,0.0043534933099513805,0.004668402402834648,0.004992048831326889,0.005323421596535987,0.005661418818061058,0.006004854968418423,0.006352469158768828,0.006702934373646771,0.0070548675381253674,0.007406840288823545,0.007757390310548353,0.008105033093302889,0.008448273959930875,0.008785620212836647,0.009115593248950902,0.009436740495320362,0.00974764702323129,0.010046946706444728,0.010333332798707337,0.010605567816948037,0.010862492629215192,0.011103034660159106,0.011326215141433048,0.011531155349481934,0.01171708178852232,0.01188333029182257,0.012029349029406075,0.01215470042479278,0.01225906199715045,0.012342226158062748,0.01240409900388478,0.012444698155216646,0.012464149704291052,0.01246268433897172,0.012440632718561601,0.01239842018170933,0.012336560870396066,0.012255651356319548,0.012156363857025156,0.012039439128940697,0.011905679123142273,0.01175593948731413,0.011591121994077089,0.011412166971763915,0.011220045808936225,0.011015753598586996,0.010800301982177393,0.010574712247528725,0.0103400087282477,0.010097212545907416,0.009847335729735214,0.009591375742165457,0.009330310432375206,0.00906509343390921,0.008796650016775199,0.00852587339900334,0.008253621517656724,0.007980714254683387,0.007707931108838188,0.007436009301189745,0.007165642298468818,0.006897478735711037,0.006632121717291193,0.006370128473525712,0.006112010348518737,0.005858233093821084,0.0056092174417414105,0.005365339931760958,0.005126933963434628,0.004894291049378999,0.004667662242420222,0.004447259711674749,0.004233258443226732,0.004025798042126285,0.0038249846136231115,0.003630892702854379,0.0034435672735879724,0.003263025708066044,0.00308925981147163,0.002922237806036532,0.0027619063013004205,0.0026081922285059443,0.002461004728555668,0.0023202369843536496,0.002185767989697433,0.002057464248163958,0.001935181396642399,0.0018187657493008017,0.0017080557588273141,0.0016028833927620267,0.0015030754236253561,0.0014084546323595447,0.0013188409253266098,0.0012340523657548715,0.001153906121096681,0.0010782193282568833,0.0010068098790771472,0.0009394971288200456,0.0008761025306931005,0.000816450199689896,0.0007603674092090841,0.0007076850240456303,0.0006582378734366466,0.0006118650678926765,0.0005684102635556408,0.0005277218778038756,0.0004896532597753785,0.0004540628194060272,0.0004208141184847839,0.00038977592711534107,0.0003608222488464365,0.00033383231759475084,0.0003086905693363201,0.00028528659138836264,0.00026351505194496675,0.0002432756123687031,0.00022447282457870878,0.00020701601571448264,0.000190819162095755,0.00017580075434294587,0.0001618836553709911,0.00014899495282257136,0.00013706580736564202,0.00012603129814492032,0.00011583026654848904,0.00010640515932860215,9.770187200090282e-05,8.966959333817389e-05,8.226065167386994e-05,7.543036363656314e-05,6.913688584941209e-05,6.334107004824395e-05,5.800632199797582e-05,5.309846451943133e-05,4.858560487703756e-05,4.4438006721981286e-05]],"type":"surface"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"scene":{"yaxis":{"title":{"text":"Expiration"},"ticktext":["2025-10-03 (3d)","2025-10-10 (10d)","2025-10-17 (17d)","2025-10-24 (24d)","2025-10-31 (31d)","2025-11-07 (38d)","2025-11-21 (52d)","2025-12-19 (80d)"],"tickvals":[0,1,2,3,4,5,6,7]},"camera":{"eye":{"x":1.5,"y":1.5,"z":1.3}},"xaxis":{"title":{"text":"Stock Price"}},"zaxis":{"title":{"text":"Probability Density"}}},"title":{"text":"3D Implied Probability Distribution - Full Option Chain"},"height":700},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('690f8eba-a762-4425-b7d5-e534a32b3bc1');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating IPDF overlay plot...
Generating mode and quartiles plot...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\pietr\AppData\Local\Temp\ipykernel_668\1272980505.py:8: UserWarning:

FigureCanvasAgg is non-interactive, and thus cannot be shown

C:\Users\pietr\AppData\Local\Temp\ipykernel_668\1272980505.py:12: UserWarning:

FigureCanvasAgg is non-interactive, and thus cannot be shown
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="IPDF_files/figure-html/cell-7-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="IPDF_files/figure-html/cell-7-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>